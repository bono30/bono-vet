<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Bono Vet - Acompanhamento</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    nav a { margin-right: 15px; cursor: pointer; text-decoration: underline; color: blue; }
    h1, h2 { margin-bottom: 10px; }
    label { display: block; margin-top: 8px; }
    input, textarea, select { width: 100%; max-width: 400px; }
    button { margin-top: 10px; }
    .registro { border: 1px solid #ccc; padding: 8px; margin-top: 10px; }
    .bloco { border: 1px solid #ccc; padding: 10px; margin-top: 15px; }
    #foto-preview { margin-top: 10px; max-width: 200px; display: block; }
    section { display: none; margin-top: 15px; }
    section.ativo { display: block; }
  </style>
</head>
<body>
  <h1>Bono Vet</h1>

  <!-- Navegação -->
  <nav>
    <a id="tab-dashboard">Dashboard</a>
    <a id="tab-registros">Registros diários</a>
  </nav>

  <!-- DASHBOARD -->
  <section id="sec-dashboard" class="ativo">
    <div class="bloco">
      <h2>Dados do cachorro</h2>
      <form id="form-cachorro">
        <label for="nome">Nome</label>
        <input type="text" id="nome" required>

        <label for="nascimento">Data de nascimento</label>
        <input type="date" id="nascimento" required>

        <label for="raca">Raça</label>
        <select id="raca" required>
          <option value="">Selecione a raça</option>
          <option value="SRD (vira-lata)">SRD (vira-lata)</option>
          <option value="Labrador Retriever">Labrador Retriever</option>
          <option value="Golden Retriever">Golden Retriever</option>
          <option value="Poodle">Poodle</option>
          <option value="Shih Tzu">Shih Tzu</option>
          <option value="Yorkshire Terrier">Yorkshire Terrier</option>
          <option value="Bulldog Francês">Bulldog Francês</option>
          <option value="Border Collie">Border Collie</option>
          <option value="Pastor Alemão">Pastor Alemão</option>
          <option value="Beagle">Beagle</option>
        </select>

        <label for="foto">Foto</label>
        <input type="file" id="foto" accept="image/*">

        <button type="submit">Salvar/Atualizar</button>
      </form>
      <img id="foto-preview" src="" alt="Foto do cachorro" style="display:none; max-width:200px;">
    </div>

    <div class="bloco">
      <h2>Informações salvas</h2>
      <p><strong>Nome:</strong> <span id="info-nome">-</span></p>
      <p><strong>Nascimento:</strong> <span id="info-nascimento">-</span></p>
      <p><strong>Raça:</strong> <span id="info-raca">-</span></p>
      <img id="info-foto" src="" alt="Foto salva do cachorro" style="max-width:200px; display:none;">
    </div>
  </section>

  <!-- REGISTROS DIÁRIOS -->
  <section id="sec-registros">
    <div class="bloco">
      <h2>Registrar dados do dia</h2>
      <form id="form-registro">
        <label for="data">Data</label>
        <input type="date" id="data" required>

        <label for="peso">Peso (kg)</label>
        <input type="number" id="peso" step="0.1" required>

        <label for="obs">Observações</label>
        <textarea id="obs" rows="3"></textarea>

        <button type="submit">Salvar registro</button>
      </form>
    </div>

    <div class="bloco">
      <h2>Registros salvos</h2>
      <div id="lista-registros"></div>
    </div>
  </section>

  <!-- SCRIPT -->
  <script type="module">
    // Abas
    const secDashboard = document.getElementById("sec-dashboard");
    const secRegistros = document.getElementById("sec-registros");
    document.getElementById("tab-dashboard").addEventListener("click", () => {
      secDashboard.classList.add("ativo");
      secRegistros.classList.remove("ativo");
    });
    document.getElementById("tab-registros").addEventListener("click", () => {
      secRegistros.classList.add("ativo");
      secDashboard.classList.remove("ativo");
    });

    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-database.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-storage.js";

    // Config do seu projeto
    const firebaseConfig = {
      apiKey: "AIzaSyDbKzICgL6dgYz18zwf98WpaOZNcJ_sGSk",
      authDomain: "bono-vet.firebaseapp.com",
      databaseURL: "https://bono-vet-default-rtdb.firebaseio.com",
      projectId: "bono-vet",
      storageBucket: "bono-vet.firebasestorage.app",
      messagingSenderId: "922268528742",
      appId: "1:922268528742:web:be2b877ca6cd77144b3da7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const storage = getStorage(app);

    // DASHBOARD
    const formCachorro = document.getElementById("form-cachorro");
    const inputFoto = document.getElementById("foto");
    const fotoPreview = document.getElementById("foto-preview");
    const infoNome = document.getElementById("info-nome");
    const infoNasc = document.getElementById("info-nascimento");
    const infoRaca = document.getElementById("info-raca");
    const infoFoto = document.getElementById("info-foto");
    let fotoFile = null;

    inputFoto.addEventListener("change", () => {
      const file = inputFoto.files[0];
      fotoFile = file || null;
      if (file) {
        const url = URL.createObjectURL(file);
        fotoPreview.src = url;
        fotoPreview.style.display = "block";
      } else {
        fotoPreview.style.display = "none";
      }
    });

    formCachorro.addEventListener("submit", async (e) => {
      e.preventDefault();
      const nome = document.getElementById("nome").value;
      const nascimento = document.getElementById("nascimento").value;
      const raca = document.getElementById("raca").value;

      let fotoURL = null;
      if (fotoFile) {
        const caminho = `fotos/${Date.now()}_${fotoFile.name}`;
        const fotoRef = sRef(storage, caminho);
        await uploadBytes(fotoRef, fotoFile);
        fotoURL = await getDownloadURL(fotoRef);
      }

      const dados = { nome, nascimento, raca };
      if (fotoURL) dados.fotoURL = fotoURL;

      await set(ref(db, "cachorro"), dados);
      alert("Dados do cachorro salvos/atualizados!");
      formCachorro.reset();
      fotoPreview.style.display = "none";
      fotoFile = null;
    });

    onValue(ref(db, "cachorro"), (snapshot) => {
      const dados = snapshot.val();
      if (!dados) return;
      infoNome.textContent = dados.nome || "-";
      infoNasc.textContent = dados.nascimento || "-";
      infoRaca.textContent = dados.raca || "-";
      if (dados.fotoURL) {
        infoFoto.src = dados.fotoURL;
        infoFoto.style.display = "block";
      } else {
        infoFoto.style.display = "none";
      }
    });

    // REGISTROS DIÁRIOS
    const formRegistro = document.getElementById("form-registro");
    const divLista = document.getElementById("lista-registros");

    formRegistro.addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = document.getElementById("data").value;
      const peso = document.getElementById("peso").value;
      const obs = document.getElementById("obs").value;

      const registrosRef = ref(db, "registros");
      await push(registrosRef, {
        data,
        peso,
        obs,
        criadoEm: new Date().toISOString()
      });

      formRegistro.reset();
      alert("Registro salvo!");
    });

    const registrosRef = ref(db, "registros");
    onValue(registrosRef, (snapshot) => {
      const dados = snapshot.val();
      divLista.innerHTML = "";
      if (!dados) {
        divLista.innerHTML = "<p>Ainda não há registros.</p>";
        return;
      }
      const lista = Object.entries(dados);
      lista.sort((a, b) => {
        const d1 = new Date(a[1].criadoEm || 0);
        const d2 = new Date(b[1].criadoEm || 0);
        return d2 - d1;
      });
      for (const [id, reg] of lista) {
        const div = document.createElement("div");
        div.className = "registro";
        div.innerHTML = `
          <strong>Data:</strong> ${reg.data || "-"}<br>
          <strong>Peso:</strong> ${reg.peso || "-"} kg<br>
          <strong>Obs:</strong> ${reg.obs || ""}<br>
          <small>ID: ${id}</small>
        `;
        divLista.appendChild(div);
      }
    });
  </script>
</body>
</html>
